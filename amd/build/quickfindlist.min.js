define(["jquery","core/str"],function(a,b){var c={sesskey:null,instances:[]},d={init:function(b,e,f,g,h,i){c.sesskey=i;var j={roleid:b,userfields:e,url:f,courseformat:g,courseid:h,progress:a("#quickfindprogress"+b),listcontainer:a("#quickfindlist"+b),xhr:null};c.instances[b]=j,a("#quickfindlistsearch"+b).on("keyup",d.search_on_type),a("#quickfindform"+b).on("submit",d.search_on_submit)},search_on_type:function(b){var c=a(b.target),e=c.val(),f=/[\-0-9]+/.exec(c.attr("id"))[0];d.search(e,f),M.util.js_pending("quickfindlist"+f)},search_on_submit:function(b){b.preventDefault();var c=a(b.target),e=/[\-0-9]+/.exec(c.attr("id"))[0],f=c.find("#quickfindlistsearch"+e).val();d.search(f,e),M.util.js_pending("quickfindlist"+e)},search:function(d,e){var f=c.instances[e],g=M.cfg.wwwroot+"/blocks/quickfindlist/quickfind.php";null!==f.xhr&&f.xhr.abort(),f.progress.css("visibility","visible"),f.xhr=a.ajax({url:g,data:{role:e,name:d,courseformat:f.courseformat,courseid:f.courseid,sesskey:c.sesskey}}).done(function(c){var d=a('<ul class="dropdown-menu" />'),g="--";b.get_strings([{key:"noresults",component:"block_quickfindlist"}]).done(function(a){g=a[0]}).fail();var h=a('<li><a class="disabled">'+g+"</a></li>"),i="";for(var j in c.people){i=f.userfields.replace("[[firstname]]",c.people[j].firstname),i=i.replace("[[lastname]]",c.people[j].lastname),i=i.replace("[[username]]",c.people[j].username);var k=a('<li><a href="'+f.url+"&id="+c.people[j].id+'">'+i+"</a></li>");d.append(k)}if(""===i)d.append(h);else if(c.results){var l=a('<li><span class="disabled">'+c.results+"</span></li>");d.append(l)}""===c.needle&&d.css("visibility","hidden"),a("#quickfindlist"+e).replaceWith(d),d.attr("id","quickfindlist"+e)}).fail(function(a,b){"abort"!==b&&void 0!==b&&f.listcontainer.html(b)}).always(function(){f.progress.css("visibility","hidden"),M.util.js_complete("quickfindlist"+e)})}};return d});